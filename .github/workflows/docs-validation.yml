name: Documentation Validation

on:
  push:
    branches: [ main, develop ]
    paths:
      - '**.md'
      - '.github/workflows/docs-validation.yml'
  pull_request:
    branches: [ main, develop ]
    paths:
      - '**.md'

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Check Markdown links
      uses: gaurav-nelson/github-action-markdown-link-check@v1
      with:
        use-quiet-mode: 'yes'
        config-file: '.github/mlc_config.json'
      continue-on-error: true

    - name: Lint Markdown
      uses: DavidAnson/markdownlint-cli2-action@v15
      with:
        globs: '**/*.md'
      continue-on-error: true

    - name: Check spelling
      uses: streetsidesoftware/cspell-action@v7
      with:
        files: '**/*.md'
        config: '.github/cspell.json'
      continue-on-error: true

    - name: Validate TODO.md structure
      run: |
        echo "Checking TODO.md task count..."
        if [ -f "TODO.md" ]; then
          TASK_COUNT=$(grep -c "- \[ \]" TODO.md || true)
          echo "Found $TASK_COUNT pending tasks in TODO.md"
        fi

    - name: Check documentation completeness
      run: |
        echo "Checking for required documentation files..."
        REQUIRED_DOCS=("README.md" "REQUIREMENTS.md" "TODO.md" "CONTRIBUTING.md" "CODE_OF_CONDUCT.md" "SECURITY.md" "LICENSE")
        for doc in "${REQUIRED_DOCS[@]}"; do
          if [ -f "$doc" ]; then
            echo "✓ $doc exists"
          else
            echo "✗ $doc missing"
            exit 1
          fi
        done
